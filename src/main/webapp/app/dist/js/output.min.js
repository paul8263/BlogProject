/* Created by Paul. Version: 0.0.0 . Compiled on Fri Apr 17 2015 14:16:10 GMT+1000 (AEST) */
angular.module("app",["ui.router","ngAnimate","ngResource","ui.bootstrap","app.home","app.signIn","app.register","app.userProfile","app.changeUserProfile","app.createModifyBlog","app.viewBlog"]).config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/home")}).value("basePath","/myblog/").run(function($rootScope,$state){$rootScope.state=$state}).factory("userResource",function($resource,basePath){var res=$resource(basePath+"user/:userId",{userId:"@userId"},{update:{method:"PUT"}});return{addUser:function(user,success,failure){res.save(user,success,failure)},updateUser:function(user,success,failure){res.update(user,success,failure)},getAllUsers:function(pageData,success,failure){res.get(pageData,success,failure)},deleteUser:function(success,failure){res["delete"](success,failure)},getOneUser:function(userId,success,failure){res.get({userId:userId},success,failure)}}}).factory("blogResource",function($resource,basePath){var res=$resource(basePath+"user/:userId/blog/:blogId",{userId:"@userId",blogId:"@blogId"},{update:{method:"PUT"}});return{getAllBlogsByUser:function(userId,pageData,success,failure){res.get({userId:userId,page:pageData.page,size:pageData.size},success,failure)},getOneBlog:function(userId,blogId,success,failure){res.get({userId:userId,blogId:blogId},success,failure)},addBlog:function(userId,blog,success,failure){blog.userId=userId,res.save(blog,success,failure)},updateBlog:function(userId,blogId,blog,success,failure){blog.userId=userId,blog.blogId=blogId,res.update(blog,success,failure)},deleteBlog:function(userId,blogId,success,failure){res["delete"]({userId:userId,blogId:blogId},success,failure)},getAllBlogs:function(pageData,success,failure){var getAllBlogsRes=$resource(basePath+"blog",{});getAllBlogsRes.get({page:pageData.page,size:pageData.size},success,failure)}}}).factory("userBlogCommentResource",function($resource,basePath){var resGetAllByUser=$resource(basePath+"comment/user/:userId",{userId:"@userId"}),resGetAllByBlog=$resource(basePath+"comment/blog/:blogId",{blogId:"@blogId"}),res=$resource(basePath+"comment/user/:userId/blog/:blogId",{userId:"@userId",blogId:"@blogId"},{update:{method:"PUT"}});return{getAllByUser:function(userId,pageData,success,failure){resGetAllByUser.get({userId:userId,page:pageData.page,size:pageData.size},success,failure)},getAllByBlog:function(blogId,pageData,success,failure){resGetAllByBlog.get({blogId:blogId,page:pageData.page,size:pageData.size},success,failure)},addComment:function(userId,blogId,comment,success,failure){comment.userId=userId,comment.blogId=blogId,res.save(comment,success,failure)},getOneComment:function(userId,blogId,success,failure){res.get({userId:userId,blogId:blogId},success,failure)},updateComment:function(userId,blogId,comment,success,failure){comment.userId=userId,comment.blogId=blogId,res.update(comment,success,failure)},deleteComment:function(userId,blogId,success,failure){res["delete"]({userId:userId,blogId:blogId},success,failure)}}}).factory("userLoginStatus",function(){var service={};return service.getUserId=function(){return localStorage.getItem("userId")},service.isLoggedIn=function(){return!(""==localStorage.getItem("userId")||null==localStorage.getItem("userId"))},service.login=function(id){localStorage.setItem("userId",id)},service.logout=function(){localStorage.removeItem("userId")},service}).controller("appCtrl",function($scope,$location,userLoginStatus){$scope.$on("$stateChangeSuccess",function(event,toState){angular.isDefined(toState.data.pageTitle)&&($scope.pageTitle=toState.data.pageTitle+" | My Blog")}),$scope.isLoggedIn=userLoginStatus.isLoggedIn(),$scope.toggle=function(){$scope.isLoggedIn=!$scope.isLoggedIn,0==userLoginStatus.isLoggedIn()?userLoginStatus.login(1):userLoginStatus.logout()}}),angular.module("app.changeUserProfile",["ui.router"]).config(function($stateProvider){$stateProvider.state("changeUserProfile",{url:"/changeUserProfile",controller:"changeUserProfileCtrl",templateUrl:"changeUserProfile/changeUserProfile.tpl.html",data:{pageTitle:"Change User Profile"}})}).controller("changeUserProfileCtrl",function($scope,$filter,$state,userResource,userLoginStatus){userResource.getOneUser(userLoginStatus.getUserId(),function(data){$scope.user=data}),$scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.opened=!0},$scope.today=function(){$scope.user.birthday=new Date},$scope.format="dd-MM-yyyy",$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.changePassword=!1,$scope.submit=function(){userResource.updateUser($scope.user,function(data){alert("success"+data.userId),userLoginStatus.login(data.userId),$state.go("home")},function(){alert("failure")})}}).directive("confirmPassword",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attr,ctrl){element.on("blur",function(){scope.$apply(function(){scope.user.password==scope.user.confirmPassword?ctrl.$setValidity("confirmValid",!0):ctrl.$setValidity("confirmValid",!1)})})}}}),angular.module("app.createModifyBlog",["ui.router","textAngular"]).config(function($stateProvider,$provide){$stateProvider.state("createModifyBlog",{url:"/createModifyBlog/:blogId",templateUrl:"createModifyBlog/createModifyBlog.tpl.html",controller:"createModifyBlogCtrl",data:{pageTitle:"Create Blog"}}),$provide.decorator("taOptions",["$delegate",function(taOptions){return taOptions.toolbar=[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","indent","outdent"],["html","insertImage","insertLink","wordcount","charcount"]],taOptions}])}).controller("createModifyBlogCtrl",function($scope,$state,$stateParams,blogResource,userLoginStatus){$scope.createModifyBlogText=""==$stateParams.blogId||null==$stateParams.blogId?"Create Blog":"Modify Blog",""==$stateParams.blogId||null==$stateParams.blogId?$scope.blog={}:blogResource.getOneBlog(userLoginStatus.getUserId(),$stateParams.blogId,function(data){alert("success"),$scope.blog=data},function(){alert("failure")}),$scope.submit=function(){null==$stateParams.blogId||""==$stateParams.blogId?($scope.blog.createDate=new Date,$scope.blog.modifyDate=new Date,blogResource.addBlog(userLoginStatus.getUserId(),$scope.blog,function(data){alert("create success"),$state.go("viewBlog",{userId:userLoginStatus.getUserId(),blogId:data.blogId})},function(){alert("create failure")})):($scope.blog.modifyDate=new Date,blogResource.updateBlog(userLoginStatus.getUserId(),$scope.blog.blogId,$scope.blog,function(data){alert("modify success"),$state.go("viewBlog",{userId:userLoginStatus.getUserId(),blogId:data.blogId})},function(){alert("modify failure")}))}}),angular.module("app.home",["ui.router"]).config(function($stateProvider){$stateProvider.state("home",{url:"/home",controller:"homeCtrl",templateUrl:"home/home.tpl.html",data:{pageTitle:"Home"}})}).controller("homeCtrl",function($scope,$state,blogResource,userLoginStatus){$scope.isLoggedIn=$scope.$parent.isLoggedIn,$scope.currentPage=1,blogResource.getAllBlogs({page:0,size:10},function(data){alert("success"),$scope.blogList=data},function(){alert("failure")}),$scope.pageChange=function(){blogResource.getAllBlogs({page:$scope.currentPage-1,size:10},function(data){alert("success"),$scope.blogList=data},function(){alert("failure")})},$scope.onlyViewMine=0,$scope.onlyViewMineToggle=function(){1==$scope.onlyViewMine?blogResource.getAllBlogsByUser(userLoginStatus.getUserId(),{page:$scope.currentPage-1,size:10},function(data){alert("success"),$scope.blogList=data,$scope.currentPage=0},function(){alert("failure")}):blogResource.getAllBlogs({page:$scope.currentPage-1,size:10},function(data){alert("success"),$scope.blogList=data,$scope.currentPage=0},function(){alert("failure")})},$scope.viewBlog=function(ownerId,blogId){$state.go("viewBlog",{userId:ownerId,blogId:blogId})}}),angular.module("app.register",["ui.router"]).config(function($stateProvider){$stateProvider.state("register",{url:"/register",controller:"registerCtrl",templateUrl:"register/register.tpl.html",data:{pageTitle:"Register"}})}).controller("registerCtrl",function($scope,$state,userResource,userLoginStatus){$scope.user={},$scope.user.gender="MALE",$scope.user.birthday="1970-01-01",$scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.opened=!0},$scope.today=function(){$scope.user.birthday=new Date},$scope.format="dd-MM-yyyy",$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.submit=function(){$scope.registerForm.$valid&&userResource.addUser($scope.user,function(data){$scope.$parent.isLoggedIn=!0,$scope.$parent.userId=data.userId,userLoginStatus.login(data.userId),$state.go("home")},function(){alert("Failure")})}}).directive("confirmPassword",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attr,ctrl){element.on("blur",function(){scope.$apply(function(){scope.user.password==scope.user.confirmPassword?ctrl.$setValidity("confirmValid",!0):ctrl.$setValidity("confirmValid",!1)})})}}}),angular.module("app.signIn",["ui.router"]).config(function($stateProvider){$stateProvider.state("signin",{url:"/signin",controller:"signInCtrl",templateUrl:"signIn/signIn.tpl.html",data:{pageTitle:"Sign In"}})}).controller("signInCtrl",function($scope){$scope.user={},$scope.submit=function(){alert($scope.user.username),alert($scope.user.password)}}),angular.module("app.userProfile",["ui.router"]).config(function($stateProvider){$stateProvider.state("userProfile",{url:"/userProfile",templateUrl:"userProfile/userProfile.tpl.html",controller:"userProfileCtrl",data:{pageTitle:"User Profile"}})}).controller("userProfileCtrl",function($scope,userLoginStatus,userResource){userResource.getOneUser(userLoginStatus.getUserId(),function(data){alert("success"),$scope.user=data},function(){alert("Failure")})}),angular.module("app.viewBlog",["ui.router","textAngular"]).config(function($stateProvider){$stateProvider.state("viewBlog",{url:"/viewBlog/:userId/:blogId",templateUrl:"viewBlog/viewBlog.tpl.html",controller:"viewBlogCtrl",data:{pageTitle:"View Blog"}})}).controller("viewBlogCtrl",function($scope,$state,$stateParams,blogResource,userLoginStatus,userBlogCommentResource){$scope.comment={},blogResource.getOneBlog($stateParams.userId,$stateParams.blogId,function(data){alert("success"),$scope.blog=data},function(){alert("failure")}),$scope.modifiable=$stateParams.userId==userLoginStatus.getUserId(),$scope.modify=function(){$state.go("createModifyBlog",{blogId:$scope.blog.blogId})},$scope["delete"]=function(){var result=confirm("Do you really want to delete?");1==result&&blogResource.deleteBlog(userLoginStatus.getUserId(),$scope.blog.blogId,function(){alert("success"),$state.go("home")},function(){alert("failure")})},userBlogCommentResource.getOneComment(userLoginStatus.getUserId(),$stateParams.blogId,function(data){$scope.commentable=null==data||""==data?!0:!1},function(){alert("failure"),$scope.commentable=!0}),userBlogCommentResource.getAllByBlog($stateParams.blogId,{page:0,size:5},function(data){$scope.userBlogCommentList=data},function(){alert("Retrieve comment failure")}),$scope.pageChange=function(){userBlogCommentResource.getAllByBlog($stateParams.blogId,{page:$scope.currentPage-1,size:5},function(data){$scope.userBlogCommentList=data},function(){alert("Retrieve comment failure")})},$scope.submitComment=function(){$scope.comment.commentDate=new Date,userBlogCommentResource.addComment(userLoginStatus.getUserId(),$stateParams.blogId,$scope.comment,function(){userBlogCommentResource.getAllByBlog($stateParams.blogId,{page:0,size:5},function(data){$scope.userBlogCommentList=data,$scope.commentable=!1},function(){alert("Retrieve comment failure")})},function(){alert("falure")})}});